@model IEnumerable<ChatApp.Core.Entities.Chat>

@{
    ViewBag.Title = "Your Chats";
}

<!-- Include external dependencies -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" asp-append-version="true" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.6.8-fix/jquery.nicescroll.min.js" asp-append-version="true"></script>

<div class="container">
    <div class="content container-fluid bootstrap snippets bootdey">
        <div class="row row-broken">
            <div class="col-sm-12">
                <div class="col-inside-lg decor-default" style="overflow: hidden; outline: none;" tabindex="5000">
                    <h6>Your Chats</h6>
                    <div>
                        <a href="@Url.Action("CreateGroup")" class="btn btn-primary btn-sm me-2">
                            <i class="fa fa-users"></i> Create Group
                        </a>
                        <a href="@Url.Action("Create")" class="btn btn-secondary btn-sm">
                            <i class="fa fa-user-plus"></i> Add User Chat
                        </a>
                    </div>
                    <div class="chat-list">
                        @foreach (var chat in Model)
                        {
                            <a href="@Url.Action("Index", new { chatId = chat.Id })" class="chat-item">
                                <div class="avatar">
                                    <img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="@chat.Name" />
                                    <div class="status offline"></div>
                                </div>
                                <div class="chat-info">
                                    <div class="name">@chat.Name</div>
                                    <div class="last-message">
                                        @(chat.LastMessageSent?.MessageText ?? "No messages yet")
                                    </div>
                                </div>
                                <div class="time">
                                    @(chat.LastMessageSent?.Date.ToString("hh:mm tt") ?? "")
                                </div>
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include jQuery and custom JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" asp-append-version="true"></script>
<script src="~/js/site.js" asp-append-version="true"></script>

<style>
    /* Keep all existing styles from index */
    body {
        margin-top: 20px;
        background: #eee;
    }
    .row.row-broken {
        padding-bottom: 0;
    }
    .col-inside-lg {
        padding: 20px;
    }
    .chat {
        height: calc(100vh - 180px);
    }
    .decor-default {
        background-color: #ffffff;
    }

    /* Chat list specific styles */
    .chat-list {
        margin-top: 20px;
    }

    .chat-item {
        display: flex;
        align-items: center;
        padding: 15px 10px;
        border-bottom: 1px solid #eee;
        text-decoration: none;
        color: #333;
        transition: background-color 0.2s;
    }

    .chat-item:hover {
        background-color: #f9f9f9;
    }

    .chat-item .avatar {
        position: relative;
        width: 50px;
        height: 50px;
        margin-right: 15px;
    }

    .chat-item .avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
    }

    .chat-item .status {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid white;
    }

    .chat-item .status.online {
        background: #4caf50;
    }

    .chat-item .status.offline {
        background: #ed4e6e;
    }

    .chat-item .status.busy {
        background: #ffc107;
    }

    .chat-item .chat-info {
        flex: 1;
        min-width: 0;
    }

    .chat-item .name {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .chat-item .last-message {
        font-size: 14px;
        color: #777;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .chat-item .time {
        font-size: 12px;
        color: #999;
        margin-left: 10px;
    }
</style>

<script>
    $(function () {
        $(".chat").niceScroll();
    });
</script>